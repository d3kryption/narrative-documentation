import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import RoadmapDetails from '/src/components/roadmap-details.mdx'
import Columns from '/src/components/Columns';
import Column from '/src/components/Column';
import RoadmapData from '/src/roadmap.json'

export function loopQuarters(data, product) {
    let columns = [];
    let dataFound = false;

    data.forEach((item, index) => {

        const productRoadmap = RoadmapData?.filter((card) => card.product.includes(product) && card.year === item.year && card.quarter === item.quarter);

        const hasItems = !!productRoadmap.length

        if (hasItems)
            dataFound = true;

        const roadmapDetails = hasItems ? (
                <RoadmapDetails data={productRoadmap}></RoadmapDetails>
            )
            :
            'No updates planned at the moment.'

        columns.push(
            <Column className='text--left' header={item.header} key={index}>
                {roadmapDetails}
            </Column>
        )
    })

    if (dataFound)
        return (
            <Columns>
                {columns}
            </Columns>
        )

    return (
        <div>
            <p>No planned work for this module.</p>
            <p>Feel free to recommend ideas in the <a href="https://discord.gg/qyVJmpQ2Pn">Discord</a>!</p>
        </div>
    )
}

export function GetProductTabs(columns) {
    // default products
    let tabs = [
        {
            product: "pro",
            name: "Pro"
        },
        {
            product: "interaction",
            name: "Interaction"
        },
        {
            product: "inventory",
            name: "Inventory"
        },
        {
            product: "tales",
            name: "Tales"
        },
        {
            product: "navigator",
            name: "Navigator"
        },
        {
            product: "commonui",
            name: "Common UI"
        },
    ]

    // find any custom product names and add them
    RoadmapData?.forEach(item => {
        item.product.forEach(product => {
            if (!tabs.find(x => x.name === product))
            {
                tabs.push(
                    {
                        product: product.toLowerCase(),
                        name: product
                    }
                )
            }
        })
    })

    // sort the tabs alphabetically
    tabs = tabs.sort((a, b) => a.product > b.product ? 1 : -1)

    // return the new tabs
    return tabs.map((row, index) =>
        <TabItem value={row.product} label={row.name} key={index} default>
            {loopQuarters(columns, row.name)}
        </TabItem>
    )
}

<Tabs>
    {GetProductTabs(props.columns)}
</Tabs>